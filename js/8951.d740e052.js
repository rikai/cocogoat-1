(self["define"]=self["define"]||[]).push([[8951],{932:function(n,t){
/**
 * @author Markus Ekholm
 * @copyright 2012-2016 (c) Markus Ekholm <markus at botten dot org >
 * @license Copyright (c) 2012-2016, Markus Ekholm
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *    * Redistributions of source code must retain the above copyright
 *      notice, this list of conditions and the following disclaimer.
 *    * Redistributions in binary form must reproduce the above copyright
 *      notice, this list of conditions and the following disclaimer in the
 *      documentation and/or other materials provided with the distribution.
 *    * Neither the name of the author nor the
 *      names of its contributors may be used to endorse or promote products
 *      derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL MARKUS EKHOLM BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
t.rgb_to_lab=o,t.rgba_to_lab=r,t.normalize_rgb=c;var e=Math.pow;Math.sqrt;function r(n,t){n=c(n);t="undefined"!==typeof t?c(t):{R:255,G:255,B:255};var e={R:t.R+(n.R-t.R)*n.A,G:t.G+(n.G-t.G)*n.A,B:t.B+(n.B-t.B)*n.A};return o(e)}function o(n){return i(a(n))}function a(n){n=c(n);var t=n.R/255,r=n.G/255,o=n.B/255;t>.04045?t=e((t+.055)/1.055,2.4):t/=12.92,r>.04045?r=e((r+.055)/1.055,2.4):r/=12.92,o>.04045?o=e((o+.055)/1.055,2.4):o/=12.92,t*=100,r*=100,o*=100;var a=.4124*t+.3576*r+.1805*o,i=.2126*t+.7152*r+.0722*o,u=.0193*t+.1192*r+.9505*o;return{X:a,Y:i,Z:u}}function i(n){var t=100,r=108.883,o=95.047,a=n.Y/t,i=n.Z/r,c=n.X/o;c=c>.008856?e(c,1/3):7.787*c+16/116,a=a>.008856?e(a,1/3):7.787*a+16/116,i=i>.008856?e(i,1/3):7.787*i+16/116;var u=116*a-16,s=500*(c-a),l=200*(a-i);return{L:u,a:s,b:l}}function c(n){var t={R:n.R||n.r||0,G:n.G||n.g||0,B:n.B||n.b||0};return"undefined"===typeof n.a&&"undefined"===typeof n.A||(t.A=n.A||n.a||0),t}},30951:function(n,t,e){e(21703),
/**
 * @author Markus Ekholm
 * @copyright 2012-2016 (c) Markus Ekholm <markus at botten dot org >
 * @license Copyright (c) 2012-2016, Markus Ekholm
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *    * Redistributions of source code must retain the above copyright
 *      notice, this list of conditions and the following disclaimer.
 *    * Redistributions in binary form must reproduce the above copyright
 *      notice, this list of conditions and the following disclaimer in the
 *      documentation and/or other materials provided with the distribution.
 *    * Neither the name of the author nor the
 *      names of its contributors may be used to endorse or promote products
 *      derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL MARKUS EKHOLM BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
t.ciede2000=f;var r=Math.sqrt,o=Math.pow,a=Math.cos,i=Math.atan2,c=Math.sin,u=Math.abs,s=Math.exp,l=Math.PI;function f(n,t){var e=n.L,i=n.a,u=n.b,l=t.L,f=t.a,h=t.b,y=1,R=1,g=1,w=r(o(i,2)+o(u,2)),m=r(o(f,2)+o(h,2)),b=(w+m)/2,A=.5*(1-r(o(b,7)/(o(b,7)+o(25,7)))),M=(1+A)*i,C=(1+A)*f,O=r(o(M,2)+o(u,2)),B=r(o(C,2)+o(h,2)),x=_(u,M),E=_(h,C),G=l-e,N=B-O,S=p(w,m,x,E),Z=2*r(O*B)*c(d(S)/2),k=(e+l)/2,Y=(O+B)/2,I=v(w,m,x,E),T=1-.17*a(d(I-30))+.24*a(d(2*I))+.32*a(d(3*I+6))-.2*a(d(4*I-63)),H=30*s(-o((I-275)/25,2)),j=r(o(Y,7)/(o(Y,7)+o(25,7))),L=1+.015*o(k-50,2)/r(20+o(k-50,2)),P=1+.045*Y,z=1+.015*Y*T,V=-2*j*c(d(2*H)),X=r(o(G/(L*y),2)+o(N/(P*R),2)+o(Z/(z*g),2)+V*(N/(P*R))*(Z/(z*g)));return X}function h(n){return n*(180/l)}function d(n){return n*(l/180)}function _(n,t){if(0===n&&0===t)return 0;var e=h(i(n,t));return e>=0?e:e+360}function p(n,t,e,r){if(n*t===0)return 0;if(u(r-e)<=180)return r-e;if(r-e>180)return r-e-360;if(r-e<-180)return r-e+360;throw new Error}function v(n,t,e,r){if(n*t===0)return e+r;if(u(e-r)<=180)return(e+r)/2;if(u(e-r)>180&&e+r<360)return(e+r+360)/2;if(u(e-r)>180&&e+r>=360)return(e+r-360)/2;throw new Error}},61009:function(n,t,e){"use strict";var r=e(30951),o=e(932),a=e(65536),i=n.exports={};i.diff=r.ciede2000,i.rgb_to_lab=o.rgb_to_lab,i.rgba_to_lab=o.rgba_to_lab,i.map_palette=a.map_palette,i.palette_map_key=a.palette_map_key,i.map_palette_lab=a.map_palette_lab,i.lab_palette_map_key=a.lab_palette_map_key,i.match_palette_lab=a.match_palette_lab,i.closest=function(n,t,e){var r=i.palette_map_key(n);e="undefined"!==typeof e?e:{R:255,G:255,B:255};var o=i.map_palette([n],t,"closest",e);return o[r]},i.furthest=function(n,t,e){var r=i.palette_map_key(n);e="undefined"!==typeof e?e:{R:255,G:255,B:255};var o=i.map_palette([n],t,"furthest",e);return o[r]},i.closest_lab=function(n,t){return i.match_palette_lab(n,t,!1)},i.furthest_lab=function(n,t){return i.match_palette_lab(n,t,!0)}},65536:function(n,t,e){
/**
 * @author Markus Ekholm
 * @copyright 2012-2016 (c) Markus Ekholm <markus at botten dot org >
 * @license Copyright (c) 2012-2016, Markus Ekholm
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *    * Redistributions of source code must retain the above copyright
 *      notice, this list of conditions and the following disclaimer.
 *    * Redistributions in binary form must reproduce the above copyright
 *      notice, this list of conditions and the following disclaimer in the
 *      documentation and/or other materials provided with the distribution.
 *    * Neither the name of the author nor the
 *      names of its contributors may be used to endorse or promote products
 *      derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL MARKUS EKHOLM BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
t.map_palette=c,t.map_palette_lab=s,t.match_palette_lab=u,t.palette_map_key=a,t.lab_palette_map_key=i;var r=e(30951).ciede2000,o=e(932);function a(n){n=o.normalize_rgb(n);var t="R"+n.R+"B"+n.B+"G"+n.G;return"A"in n&&(t=t+"A"+n.A),t}function i(n){return"L"+n.L+"a"+n.a+"b"+n.b}function c(n,t,e,r){var o={};r="undefined"!==typeof r?r:{R:255,G:255,B:255},e=e||"closest";for(var i=0;i<n.length;i+=1){for(var c=n[i],u=void 0,s=void 0,f=0;f<t.length;f+=1){var h=t[f],d=l(c,h,r);void 0==u||"closest"===e&&d<s?(u=h,s=d):"furthest"===e&&d>s&&(u=h,s=d)}o[a(c)]=u}return o}function u(n,t,e){for(var o,a,i=t[0],c=r(n,i),u=1,s=t.length;u<s;u+=1)o=t[u],a=r(n,o),(!e&&a<c||e&&a>c)&&(i=o,c=a);return i}function s(n,t,e){for(var r={},o="furthest"===e,a=0;a<n.length;a+=1){var c=n[a];r[i(c)]=u(c,t,o)}return r}function l(n,t,e){var a=o.rgb_to_lab,i=o.rgb_to_lab,c=function(n){return o.rgba_to_lab(n,e)};return"A"in n&&(a=c),"A"in t&&(i=c),n=a(n),t=i(t),r(n,t)}},13817:function(n,t,e){"use strict";e.d(t,{S1:function(){return s},jh:function(){return l}});e(48675),e(3462),e(21703);var r=e(84118),o=e(91773),a=e(71836);const i=o.toString().trim().replace(/\r/g,"").split("\n");r.env.wasm.wasmPaths=a.ZP,r.env.wasm.numThreads=1;let c=null;function u(n){return Float32Array.from(n.map((n=>n/255)))}async function s(){return c=await r.InferenceSession.create(a.ZP["yas.ort"]),c}async function l(n){if(c||await s(),c){if(32!==n.rows||384!==n.cols)throw new Error("Wrong mat size");const t=new r.Tensor(u(n.data),[1,1,32,384]),e={[c.inputNames[0]]:t},o=await c.run(e),a=o[c.outputNames[0]].data,s=o[c.outputNames[0]].dims;let l=0,f=0;const h=[];for(let n=0;n<s[0];n++){const t=a.slice(n*s[2],(n+1)*s[2]),e=Math.max(...t),r=t.indexOf(e);r>0&&(f+=1+e,l+=1,h.push(i[r]))}return{text:h.join("").replace(/(.)\1+/g,"$1").replace(/\0/g,""),confidence:parseFloat((f/l*100).toFixed(2))}}throw new Error("init faild")}},23676:function(n,t,e){"use strict";e.d(t,{x:function(){return a},W:function(){return i}});var r=e(89039);let o;async function a(n){if(!1===n){try{var t;null===(t=o)||void 0===t||t.delete()}catch(c){}return o=null,-1}const e=await(0,r.Yk)();if(!o)return o=(0,r.SM)(e,n),e.cvtColor(o,o,e.COLOR_RGBA2GRAY,0),-1;const a=(0,r.SM)(e,n);e.cvtColor(a,a,e.COLOR_RGBA2GRAY,0),e.absdiff(o,a,a),e.threshold(a,a,150,255,e.THRESH_BINARY);const i=e.countNonZero(a);return a.delete(),o=(0,r.SM)(e,n),e.cvtColor(o,o,e.COLOR_RGBA2GRAY,0),i}async function i(n){if(!1===n){try{var t;null===(t=o)||void 0===t||t.delete()}catch(c){}return o=null,-1}const e=await(0,r.Yk)();if(!o)return o=(0,r.SM)(e,n),e.cvtColor(o,o,e.COLOR_RGBA2GRAY,0),-1;const a=(0,r.SM)(e,n);e.cvtColor(a,a,e.COLOR_RGBA2GRAY,0),e.absdiff(o,a,a),e.adaptiveThreshold(a,a,255,e.ADAPTIVE_THRESH_GUASS_C,e.THRESH_BINARY,3,4);const i=e.countNonZero(a);return a.delete(),i}},72725:function(n,t,e){"use strict";e.r(t),e.d(t,{analyzeBag:function(){return cn},analyzeBlocks:function(){return un},normalizeToYas:function(){return an}});e(21703);var r=e(12507),o=e(89039),a=e(530),i=e(99077),c=1,u=2;function s(n,t,e,r){var o=e.length,s=o,l=!r;if(null==n)return!s;n=Object(n);while(o--){var f=e[o];if(l&&f[2]?f[1]!==n[f[0]]:!(f[0]in n))return!1}while(++o<s){f=e[o];var h=f[0],d=n[h],_=f[1];if(l&&f[2]){if(void 0===d&&!(h in n))return!1}else{var p=new a.Z;if(r)var v=r(d,_,h,n,t,p);if(!(void 0===v?(0,i.Z)(_,d,c|u,r,p):v))return!1}}return!0}var l=s,f=e(14496);function h(n){return n===n&&!(0,f.Z)(n)}var d=h,_=e(92409);function p(n){var t=(0,_.Z)(n),e=t.length;while(e--){var r=t[e],o=n[r];t[e]=[r,o,d(o)]}return t}var v=p;function y(n,t){return function(e){return null!=e&&(e[n]===t&&(void 0!==t||n in Object(e)))}}var R=y;function g(n){var t=v(n);return 1==t.length&&t[0][2]?R(t[0][0],t[0][1]):function(e){return e===n||l(e,n,t)}}var w=g,m=e(71989);function b(n,t){return null!=n&&t in Object(n)}var A=b,M=e(17799),C=e(13890),O=e(36264),B=e(41529),x=e(75657),E=e(73657);function G(n,t,e){t=(0,M.Z)(t,n);var r=-1,o=t.length,a=!1;while(++r<o){var i=(0,E.Z)(t[r]);if(!(a=null!=n&&e(n,i)))break;n=n[i]}return a||++r!=o?a:(o=null==n?0:n.length,!!o&&(0,x.Z)(o)&&(0,B.Z)(i,o)&&((0,O.Z)(n)||(0,C.Z)(n)))}var N=G;function S(n,t){return null!=n&&N(n,t,A)}var Z=S,k=e(76399),Y=1,I=2;function T(n,t){return(0,k.Z)(n)&&d(t)?R((0,E.Z)(n),t):function(e){var r=(0,m.Z)(e,n);return void 0===r&&r===t?Z(e,n):(0,i.Z)(t,r,Y|I)}}var H=T;function j(n){return n}var L=j;function P(n){return function(t){return null==t?void 0:t[n]}}var z=P,V=e(9922);function X(n){return function(t){return(0,V.Z)(t,n)}}var U=X;function D(n){return(0,k.Z)(n)?z((0,E.Z)(n)):U(n)}var q=D;function F(n){return"function"==typeof n?n:null==n?L:"object"==typeof n?(0,O.Z)(n)?H(n[0],n[1]):w(n):q(n)}var W=F;function $(n,t){var e,r=-1,o=n.length;while(++r<o){var a=t(n[r]);void 0!==a&&(e=void 0===e?a:e+a)}return e}var J=$,K=NaN;function Q(n,t){var e=null==n?0:n.length;return e?J(n,t)/e:K}var nn=Q;function tn(n,t){return nn(n,W(t,2))}var en=tn;function rn(n){return nn(n,L)}var on=rn;async function an(n,t=!0,{pre:e,post:r}={}){const a=await(0,o.Yk)(),i=n.clone();let c;if(t){e?e(n):(a.threshold(n,n,120,255,a.THRESH_BINARY),a.cvtColor(n,n,a.COLOR_RGBA2GRAY,0));const t=new a.MatVector,r=new a.Mat;a.findContours(n,t,r,a.RETR_CCOMP,a.CHAIN_APPROX_SIMPLE);let o=9999,u=9999,l=0,f=0;for(let e=0;e<t.size();++e){const r=a.boundingRect(t.get(e));r.width>=n.cols&&r.height>=n.rows||(o=Math.min(o,r.x),u=Math.min(u,r.y),l=Math.max(l,r.y+r.height),f=Math.max(f,r.x+r.width))}c=i.roi(new a.Rect(o+1,u+1,f-o-2,l-u-2));try{n.delete()}catch(s){}try{i.delete()}catch(s){}}else c=i;a.resize(c,c,new a.Size(c.cols/c.rows*32,32),0,0,a.INTER_LINEAR),r?r(c):(a.threshold(c,c,155,255,a.THRESH_BINARY),a.cvtColor(c,c,a.COLOR_RGBA2GRAY,0),a.bitwise_not(c,c));const u=new a.Mat;return a.copyMakeBorder(c,u,0,0,0,384-c.cols,a.BORDER_CONSTANT,new a.Scalar(0,0,0,255)),c.delete(),u}async function cn(n){const t=await(0,o.Yk)();let e;e=(0,r.Tj)(n)?(0,o.SM)(t,n):n;const a=new t.Mat;t.cvtColor(e,a,t.COLOR_RGBA2GRAY,0),t.adaptiveThreshold(a,a,255,t.ADAPTIVE_THRESH_GUASS_C,t.THRESH_BINARY,3,4);const i=t.Mat.ones(3,6,t.CV_8U);t.erode(a,a,i),i.delete();const c=new t.MatVector,u=new t.Mat;t.findContours(a,c,u,t.RETR_LIST,t.CHAIN_APPROX_SIMPLE);let s=null;const l=[];for(let r=0;r<c.size();++r){const n=t.boundingRect(c.get(r));if(n.width!==e.cols&&(!(n.width<16||n.height<16)&&!(n.height/n.width>10)))if(n.height>e.rows/2){if(s&&s.x>n.x)continue;s=n}else l.push(n)}if(!s)throw u.delete(),c.delete(),a.delete(),new Error("Panel not found");const f=s.x-10,h=e.cols-s.x-s.width-10,d=s.y-10,_=s.y+s.height+10,p=new t.Rect(h,d,f-h,_-d),v=l.filter((n=>n.x>f&&n.y<d)),y=v.sort(((n,t)=>t.x-n.x))[0],R=v.filter((n=>n.height!==y.height&&n.y<y.y+y.height))[0],g=l.filter((n=>n.x<h&&n.y>_)).sort(((n,t)=>n.x-t.x))[0],w=l.filter((n=>s&&n.x>=s.x-10&&n.y<=s.y&&n.y>R.y+R.height)).sort(((n,t)=>n.y-t.y))[0];return w&&(s.y=w.y-10,p.y=w.y-10),g&&(s.height=g.y-s.y-5,p.height=g.y-s.y-5),a.delete(),u.delete(),c.delete(),{panelRect:s,centerRect:p,countRect:R}}async function un(n,t){const e=await(0,o.Yk)(),r=new e.Mat,a=new e.Mat,i=new e.Mat,c=new e.MatVector,u=new e.Mat,s=n.roi(t),l=new e.MatVector;e.split(s,l);const f=-1;e.subtract(l.get(3),l.get(2),r,i,f),e.threshold(r,r,40,255,e.THRESH_BINARY_INV),e.subtract(l.get(1),l.get(2),a,i,f),e.threshold(a,a,40,255,e.THRESH_BINARY_INV),e.subtract(a,r,r,i,f);const h=e.Mat.ones(8,3,e.CV_8U);e.erode(r,r,h),h.delete(),e.findContours(r,c,u,e.RETR_LIST,e.CHAIN_APPROX_SIMPLE);const d={},_={};let p=[];for(let o=0;o<c.size();++o){const n=e.boundingRect(c.get(o));n.width<s.cols/14||(n.width>s.cols/5||n.height/n.width>2||p.push(n))}const v=en(p,"width")/2,y=en(p,"height")/2;p=p.filter((n=>n.width>v&&n.height>y)),p.forEach((n=>{const t=Math.round(Math.round((n.x+n.width/2)/v)*v),e=Math.round(Math.round((n.y+n.height/2)/y)*y);d[t]=d[t]+1||1,_[e]=_[e]+1||1}));const R=on(Object.values(d))/2,g=on(Object.values(d))/2,w={x:[],y:[]};for(const o of Object.keys(d))d[Number(o)]<R||w.x.push(Number(o));for(const o of Object.keys(_))_[Number(o)]<g||w.y.push(Number(o));return r.delete(),a.delete(),i.delete(),u.delete(),c.delete(),s.delete(),w}},9854:function(n,t,e){"use strict";e.d(t,{Gu:function(){return r},yN:function(){return o},Z8:function(){return a},y9:function(){return i}});let r=[],o=[],a=[];function i(n,t,e){o=[],Object.keys(t).forEach((n=>{o.push({obj:n,str:t[n]})})),r=[],n.forEach((n=>{for(const t of["circlet","goblet","sands","flower","plume"])t in n&&r.push({str:n[t].name,obj:[n.id,t]})})),a=[],e.forEach((n=>{a.push({obj:n.id,str:n.name})})),console.log("created artifact map with length=",r.length,o.length,a.length)}},31912:function(n,t,e){"use strict";e.r(t),e.d(t,{detectStars:function(){return A},init:function(){return h},onScreenShot:function(){return p},rawRecognizeArtifact:function(){return y},recognizeArtifact:function(){return v},setCachedBag:function(){return _},splitBottom:function(){return g},splitTop:function(){return w},splitUser:function(){return R}});e(21703);var r,o,a=e(89039),i=e(13817),c=e(72725),u=e(61009);(function(n){n["static"]="static",n["percent"]="percent"})(r||(r={})),function(n){n["flower"]="flower",n["plume"]="plume",n["sands"]="sands",n["goblet"]="goblet",n["circlet"]="circlet"}(o||(o={})),function(n){n[n["hp"]=0]="hp",n[n["atk"]=1]="atk",n[n["def"]=2]="def",n[n["element"]=3]="element",n[n["recharge"]=4]="recharge",n[n["heal"]=5]="heal",n[n["crit"]=6]="crit",n[n["crit_dmg"]=7]="crit_dmg",n[n["physical_dmg"]=8]="physical_dmg",n[n["anemo_dmg"]=9]="anemo_dmg",n[n["geo_dmg"]=10]="geo_dmg",n[n["electro_dmg"]=11]="electro_dmg",n[n["hydro_dmg"]=12]="hydro_dmg",n[n["pyro_dmg"]=13]="pyro_dmg",n[n["cryo_dmg"]=14]="cryo_dmg",n[n["dendro_dmg"]=15]="dendro_dmg"}(r||(r={}));r.hp,r.atk,r.def,r.element,r.element;var s=e(9854),l=e(76520),f=e(12507);async function h(){await Promise.all([(0,a.Yk)(),(0,i.S1)()])}let d={};async function _(n){d=n}async function p(n){const t=await(0,a.Yk)();let e;e=(0,f.Tj)(n)?(0,a.SM)(t,n):n;let r=e;e.cols>e.rows&&(d.panelRect||(d=await(0,c.analyzeBag)(e)),r=e.roi(d.panelRect));const o=(0,a.gq)(t,r,!0);let i={success:!1,raw:[],image:o};try{i={...await v(r),image:o}}catch(u){console.error("number"===typeof u?(0,a.dW)(t,u):u)}try{r.delete()}catch(u){}try{e.delete()}catch(u){}return i}async function v(n){var t;const e=await y(n),a={id:Date.now().toString(16),hash:"",set:"",slot:o.plume,level:0,stars:0,mainstat:{key:"",type:r["static"]},substat:[],locked:!1,character:null},i=["name","main","sub","mainval","level","stars","lock"],c={};let u=!0;for(const o of e){let n;switch(o.type){case"lock":a.locked="1"===o.text;break;case"stars":a.stars=parseInt(o.text,10);break;case"level":if(a.level=parseInt(o.text,10),isNaN(a.level)){u=!1;break}break;case"name":n=(0,l.NE)("str",o.text,s.Gu,o.text.length/3),n&&(a.set=n.obj[0],a.slot=n.obj[1]);break;case"main":n=(0,l.NE)("str",o.text,s.yN,o.text.length/3),n&&(a.mainstat.key=n.obj);break;case"mainval":a.mainstat.type=o.text.includes("%")?r.percent:r["static"];break;case"sub":{const[t,e]=o.text.split("+");if(!e){u=!1;break}n=(0,l.NE)("str",t,s.yN,t.length),n&&a.substat.push({key:n.obj,type:e.includes("%")?r.percent:r["static"],value:Number(e.replace(/[^\d.]/g,""))});break}case"user":n=(0,l.NE)("str",(null===(t=o.text.replace("已装备","").replace("Equipped","").trim().match(/[a-zA-Z\u4e00-\u9fa5]/g))||void 0===t?void 0:t.join(""))||"",s.Z8,o.text.length),n&&(a.character=n.obj);break}c[o.type]=!0}return i.forEach((n=>{c[n]||(u=!1)})),{artifact:a,raw:e,success:u}}async function y(n){const t=await(0,a.Yk)(),e=(0,f.Tj)(n)?(0,a.SM)(t,n):n,{splitLine:r,rects:o}=await g(e),c=await w(e,r),u=[...c,...o],s=["name","main","sub","mainval","user","level"],l=[];for(const f of u)if(s.includes(f.type)&&f.roi){const n=await(0,i.jh)((0,a.gq)(t,f.roi));f.roi.delete(),l.push({type:f.type,rect:f.rect,...n})}else if("lock"===f.type&&f.roi){const n=f.roi;t.cvtColor(n,n,t.COLOR_RGBA2GRAY,0),t.threshold(n,n,110,255,t.THRESH_BINARY_INV);const e=t.countNonZero(n)>10;n.delete(),l.push({type:f.type,rect:f.rect,text:e?"1":"0",confidence:100})}else f.roi&&f.roi.delete();const h=u.find((n=>"name"===n.type));if(h){const n={x:2*h.rect.x+h.rect.width,y:h.mid},t=A([...e.ucharPtr(n.y,n.x)]);l.push({type:"stars",text:t.toString(),confidence:100,rect:{x:n.x,y:n.y,width:1,height:1}})}return(0,f.Tj)(n)&&e.delete(),l}async function R(n,{src:t,dst:e,hierarchy:r,M7:o},i){const u=await(0,a.Yk)();if(t.rows-n.rect.y-n.rect.height<n.rect.height){n.type="user",u.erode(e,e,o);const a=e.roi(n.rect);u.findContours(a,i,r,u.RETR_CCOMP,u.CHAIN_APPROX_SIMPLE);let l=9999,f=9999,h=0,d=0;for(let n=0;n<i.size();++n){const t=u.boundingRect(i.get(n));t.width>=a.cols-1||(t.height>=2*a.rows/3||t.height<=5||t.width<=5||(l=Math.min(l,t.x),f=Math.min(f,t.y),h=Math.max(h,t.y+t.height),d=Math.max(d,t.x+t.width)))}n.rect=new u.Rect(n.rect.x+l+3,n.rect.y+f+2,d-l-6,h-f-4);try{n.roi=await(0,c.normalizeToYas)(t.roi(n.rect),!1)}catch(s){throw new Error("Roi for user fielf faild")}return n}return!1}async function g(n){const t=await(0,a.Yk)(),e=n.clone();t.cvtColor(n,e,t.COLOR_RGBA2GRAY,0),t.threshold(e,e,200,255,t.THRESH_BINARY);const r=new t.MatVector,o=new t.Mat,i=t.Mat.ones(1,10,t.CV_8U),u=t.Mat.ones(3,8,t.CV_8U);t.erode(e,e,i),t.findContours(e,r,o,t.RETR_LIST,t.CHAIN_APPROX_SIMPLE),t.cvtColor(n,e,t.COLOR_RGBA2GRAY,0),t.threshold(e,e,200,255,t.THRESH_BINARY);let s=[],l=0;for(let a=0;a<r.size();++a){const e=t.boundingRect(r.get(a));e.width*e.height<40||(e.height>n.rows/2?l=e.y-5:s.push({mid:e.y+e.height/2,rect:e,type:"",roi:null}))}s=s.filter((n=>n.mid>l)).sort(((n,t)=>n.mid-t.mid));const f=s[s.length-1];s=s.slice(0,6);const h=await R(f,{src:n,dst:e,hierarchy:o,M7:u},r);h&&s.push(h);let d=0;for(const a of s){if(d<2){if(a.type=a.rect.x<n.cols/2?"level":"lock","level"===a.type){const i=e.roi(a.rect);t.findContours(i,r,o,t.RETR_CCOMP,t.CHAIN_APPROX_SIMPLE);let u=9999,s=9999,l=0,f=0;for(let n=0;n<r.size();++n){const e=t.boundingRect(r.get(n));e.width>=i.cols-1||(e.height>=i.rows-1||(u=Math.min(u,e.x),s=Math.min(s,e.y),l=Math.max(l,e.y+e.height),f=Math.max(f,e.x+e.width)))}i.delete(),a.rect=new t.Rect(a.rect.x+u,a.rect.y+s,f-u,l-s);try{a.roi=await(0,c.normalizeToYas)(n.roi(a.rect),!1,{post:n=>{t.threshold(n,n,155,255,t.THRESH_BINARY),t.cvtColor(n,n,t.COLOR_RGBA2GRAY,0)}})}catch(_){throw new Error("Roi for level faild")}}}else if(!a.type){a.type="sub";const t=3*a.rect.height/4;a.rect.x+=t,a.rect.width-=t;try{a.roi=await(0,c.normalizeToYas)(n.roi(a.rect))}catch(_){a.type=""}}try{a.roi=a.roi||n.roi(a.rect)}catch(_){throw new Error("Roi for "+a.type+" faild")}d++}return e.delete(),r.delete(),o.delete(),i.delete(),u.delete(),{rects:s,splitLine:l}}async function w(n,t){const e=await(0,a.Yk)(),r=n.roi(new e.Rect(0,0,n.cols,t)),o=new e.Mat;e.cvtColor(r,o,e.COLOR_RGBA2GRAY,0),e.threshold(o,o,170,255,e.THRESH_BINARY_INV);const i=e.Mat.ones(1,30,e.CV_8U);e.erode(o,o,i);const u=new e.MatVector,s=new e.Mat;e.findContours(o,u,s,e.RETR_LIST,e.CHAIN_APPROX_SIMPLE);let l=[];for(let a=0;a<u.size();++a){const n=e.boundingRect(u.get(a));n.width<10||n.height<10||(n.width>=r.cols-1||n.x>=r.cols/2||l.push({mid:n.y+n.height/2,rect:n,type:"",roi:null}))}l=l.sort(((n,t)=>n.mid-t.mid)),l=[{...l[0],type:"name"},{...l[2],type:"main"},{...l[3],type:"mainval"}];for(const a of l)a.rect.y=a.rect.y-2,a.rect.height=a.rect.height+4,a.roi=await(0,c.normalizeToYas)(r.roi(a.rect),!0,{pre:"main"===a.type?n=>{e.threshold(n,n,140,255,e.THRESH_BINARY_INV),e.cvtColor(n,n,e.COLOR_RGBA2GRAY,0)}:n=>{e.threshold(n,n,210,255,e.THRESH_BINARY_INV),e.cvtColor(n,n,e.COLOR_RGBA2GRAY,0)},post:"main"===a.type?n=>{e.cvtColor(n,n,e.COLOR_RGBA2GRAY,0),e.threshold(n,n,140,255,e.THRESH_BINARY)}:n=>{e.cvtColor(n,n,e.COLOR_RGBA2GRAY,0),e.threshold(n,n,200,255,e.THRESH_BINARY)}});return r.delete(),o.delete(),u.delete(),s.delete(),i.delete(),l}const m=[{R:189,G:105,B:50},{R:162,G:86,B:225},{R:80,G:128,B:204},{R:41,G:144,B:114},{R:115,G:118,B:141}],b={189:5,162:4,80:3,41:2,115:1};function A(n){const t={R:n[0],G:n[1],B:n[2]},e=(0,u.closest)(t,m);return b[e.R]||0}},91773:function(n){"use strict";n.exports="-\n \n%\n'\n+\n,\n.\n/\n0\n1\n2\n3\n4\n5\n6\n7\n8\n9\n一\n七\n万\n不\n丽\n之\n乐\n九\n乡\n书\n云\n五\n亚\n人\n伊\n众\n优\n伤\n值\n假\n停\n傲\n儿\n元\n充\n兆\n光\n克\n兜\n八\n具\n冀\n冒\n冕\n军\n冠\n冰\n决\n凝\n凭\n凯\n凶\n击\n切\n利\n别\n刻\n力\n加\n动\n勇\n勋\n北\n医\n华\n卢\n印\n历\n原\n可\n叶\n吟\n命\n唤\n嗤\n器\n回\n团\n园\n国\n圣\n圭\n坚\n坠\n垂\n垢\n埃\n堇\n塑\n墨\n士\n壮\n壶\n备\n夏\n多\n头\n奇\n契\n奥\n女\n姿\n威\n娜\n子\n孑\n学\n守\n安\n宗\n官\n定\n室\n宫\n害\n宵\n家\n容\n宿\n寒\n将\n少\n尔\n尼\n尾\n岩\n峨\n峰\n嵯\n巉\n已\n巾\n帅\n师\n希\n带\n常\n帽\n幕\n平\n幸\n座\n异\n归\n形\n徒\n御\n徽\n心\n忆\n念\n怀\n怜\n思\n恋\n悟\n悯\n感\n慧\n成\n战\n托\n执\n护\n拉\n指\n挥\n摆\n摇\n摧\n攻\n放\n故\n效\n教\n斗\n方\n旋\n无\n早\n时\n明\n易\n星\n昭\n晨\n晴\n晷\n智\n暇\n暴\n望\n朝\n期\n末\n束\n条\n杯\n枫\n枭\n柏\n染\n柚\n桃\n梦\n樽\n武\n毅\n水\n沉\n沙\n治\n泉\n波\n泷\n泽\n洛\n流\n浮\n海\n涌\n渊\n渍\n渡\n温\n游\n溯\n漏\n潜\n火\n灭\n灵\n灼\n灾\n炎\n烟\n焦\n焱\n煎\n熬\n燃\n爵\n片\n物\n特\n狂\n猎\n玄\n率\n玉\n环\n珊\n珏\n珠\n班\n理\n琢\n琴\n瑚\n瑶\n璧\n瓢\n瓮\n甘\n生\n申\n电\n留\n疗\n的\n皿\n盅\n盏\n盘\n盟\n相\n真\n矢\n短\n石\n砂\n破\n磐\n礼\n祀\n祇\n祈\n祝\n神\n祭\n离\n秋\n章\n笃\n笑\n笔\n笠\n笼\n签\n箭\n精\n糖\n素\n红\n终\n经\n结\n绝\n绩\n绫\n绯\n绿\n缠\n罗\n羁\n群\n羽\n翎\n翠\n翼\n者\n而\n耳\n胡\n胸\n能\n脱\n船\n良\n艾\n芭\n花\n芳\n苦\n茶\n荒\n荣\n药\n莉\n莎\n莫\n莲\n菈\n菱\n菲\n落\n蔷\n薇\n藏\n虺\n血\n行\n表\n裂\n装\n裟\n角\n解\n誓\n计\n记\n许\n诺\n谢\n谣\n贝\n贤\n赌\n超\n越\n踏\n辔\n辛\n辰\n达\n运\n远\n迪\n迹\n追\n逐\n通\n逝\n遍\n遗\n郎\n酒\n酣\n醉\n醒\n里\n重\n野\n金\n鍪\n钟\n铁\n铜\n银\n镜\n镡\n闲\n防\n阳\n阿\n陀\n降\n院\n险\n雨\n雪\n雷\n霆\n霜\n露\n青\n面\n音\n颜\n风\n飘\n饰\n馆\n香\n马\n骑\n骨\n骰\n骸\n鬼\n魂\n魈\n魔\n鸟\n鹤\n鹰\n鹿\n黑"},9248:function(n,t,e){"use strict";e.d(t,{Z:function(){return l}});var r=e(67158),o="__lodash_hash_undefined__";function a(n){return this.__data__.set(n,o),this}var i=a;function c(n){return this.__data__.has(n)}var u=c;function s(n){var t=-1,e=null==n?0:n.length;this.__data__=new r.Z;while(++t<e)this.add(n[t])}s.prototype.add=s.prototype.push=i,s.prototype.has=u;var l=s},99077:function(n,t,e){"use strict";e.d(t,{Z:function(){return tn}});var r=e(530),o=e(9248);function a(n,t){var e=-1,r=null==n?0:n.length;while(++e<r)if(t(n[e],e,n))return!0;return!1}var i=a,c=e(7740),u=1,s=2;function l(n,t,e,r,a,l){var f=e&u,h=n.length,d=t.length;if(h!=d&&!(f&&d>h))return!1;var _=l.get(n),p=l.get(t);if(_&&p)return _==t&&p==n;var v=-1,y=!0,R=e&s?new o.Z:void 0;l.set(n,t),l.set(t,n);while(++v<h){var g=n[v],w=t[v];if(r)var m=f?r(w,g,v,t,n,l):r(g,w,v,n,t,l);if(void 0!==m){if(m)continue;y=!1;break}if(R){if(!i(t,(function(n,t){if(!(0,c.Z)(R,t)&&(g===n||a(g,n,e,r,l)))return R.push(t)}))){y=!1;break}}else if(g!==w&&!a(g,w,e,r,l)){y=!1;break}}return l["delete"](n),l["delete"](t),y}var f=l,h=e(35836),d=e(133),_=e(48445);function p(n){var t=-1,e=Array(n.size);return n.forEach((function(n,r){e[++t]=[r,n]})),e}var v=p,y=e(62631),R=1,g=2,w="[object Boolean]",m="[object Date]",b="[object Error]",A="[object Map]",M="[object Number]",C="[object RegExp]",O="[object Set]",B="[object String]",x="[object Symbol]",E="[object ArrayBuffer]",G="[object DataView]",N=h.Z?h.Z.prototype:void 0,S=N?N.valueOf:void 0;function Z(n,t,e,r,o,a,i){switch(e){case G:if(n.byteLength!=t.byteLength||n.byteOffset!=t.byteOffset)return!1;n=n.buffer,t=t.buffer;case E:return!(n.byteLength!=t.byteLength||!a(new d.Z(n),new d.Z(t)));case w:case m:case M:return(0,_.Z)(+n,+t);case b:return n.name==t.name&&n.message==t.message;case C:case B:return n==t+"";case A:var c=v;case O:var u=r&R;if(c||(c=y.Z),n.size!=t.size&&!u)return!1;var s=i.get(n);if(s)return s==t;r|=g,i.set(n,t);var l=f(c(n),c(t),r,o,a,i);return i["delete"](n),l;case x:if(S)return S.call(n)==S.call(t)}return!1}var k=Z,Y=e(9193),I=1,T=Object.prototype,H=T.hasOwnProperty;function j(n,t,e,r,o,a){var i=e&I,c=(0,Y.Z)(n),u=c.length,s=(0,Y.Z)(t),l=s.length;if(u!=l&&!i)return!1;var f=u;while(f--){var h=c[f];if(!(i?h in t:H.call(t,h)))return!1}var d=a.get(n),_=a.get(t);if(d&&_)return d==t&&_==n;var p=!0;a.set(n,t),a.set(t,n);var v=i;while(++f<u){h=c[f];var y=n[h],R=t[h];if(r)var g=i?r(R,y,h,t,n,a):r(y,R,h,n,t,a);if(!(void 0===g?y===R||o(y,R,e,r,a):g)){p=!1;break}v||(v="constructor"==h)}if(p&&!v){var w=n.constructor,m=t.constructor;w==m||!("constructor"in n)||!("constructor"in t)||"function"==typeof w&&w instanceof w&&"function"==typeof m&&m instanceof m||(p=!1)}return a["delete"](n),a["delete"](t),p}var L=j,P=e(52216),z=e(36264),V=e(1603),X=e(63332),U=1,D="[object Arguments]",q="[object Array]",F="[object Object]",W=Object.prototype,$=W.hasOwnProperty;function J(n,t,e,o,a,i){var c=(0,z.Z)(n),u=(0,z.Z)(t),s=c?q:(0,P.Z)(n),l=u?q:(0,P.Z)(t);s=s==D?F:s,l=l==D?F:l;var h=s==F,d=l==F,_=s==l;if(_&&(0,V.Z)(n)){if(!(0,V.Z)(t))return!1;c=!0,h=!1}if(_&&!h)return i||(i=new r.Z),c||(0,X.Z)(n)?f(n,t,e,o,a,i):k(n,t,s,e,o,a,i);if(!(e&U)){var p=h&&$.call(n,"__wrapped__"),v=d&&$.call(t,"__wrapped__");if(p||v){var y=p?n.value():n,R=v?t.value():t;return i||(i=new r.Z),a(y,R,e,o,i)}}return!!_&&(i||(i=new r.Z),L(n,t,e,o,a,i))}var K=J,Q=e(8693);function nn(n,t,e,r,o){return n===t||(null==n||null==t||!(0,Q.Z)(n)&&!(0,Q.Z)(t)?n!==n&&t!==t:K(n,t,e,r,nn,o))}var tn=nn},7740:function(n,t){"use strict";function e(n,t){return n.has(t)}t["Z"]=e},62631:function(n,t){"use strict";function e(n){var t=-1,e=Array(n.size);return n.forEach((function(n){e[++t]=n})),e}t["Z"]=e}}]);