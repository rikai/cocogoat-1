"use strict";(self["define"]=self["define"]||[]).push([[370],{31060:function(e,n,s){s.d(n,{zG:function(){return m}});var r=s(61976),a=s(71836),i=s(69997),t=s(84627),o=s(40192),l=s(51020),c=s(82619),u=s(75345);function d(){let e;e=new t.Cc(new URL(s.p+s.u(4679),s.b)),console.log("Worker created using worker-plugin");const n=(0,r.Ud)(e);return{worker:n,_worker:e}}function p(){const{worker:e,_worker:n}=d(),{worker:s,_worker:r}=d(),{scannerOnImage:t,scannerOnLine:p,recognizeAchievement:v}=e,{recognizeAchievement:m,scannerOnLine:g}=s;let f=e=>{};const w=e=>{f=e},h=e=>{throw f(-99),e};n.addEventListener("error",h),r.addEventListener("error",h);const k=(async()=>{try{const[n,r]=(0,i.LS)(),t=o.hP?"ort-wasm-simd.wasm":"ort-wasm.wasm",d=o.hP?"opencv-simd.wasm":"opencv-normal.wasm";await n,await(0,i.sB)([t,d,"ppocr.ort"],(e=>f(e)),r);const p=(0,u.Z)(c.i18n.amos);await Promise.all([e.setResources(a.ZP),s.setResources(a.ZP),e.initAchievementMap(l.Z,p),s.initAchievementMap(l.Z,p)]),f(100)}catch(t){throw f(-1),t}n.removeEventListener("error",h),r.removeEventListener("error",h),await Promise.all([e.init(),s.init()])})();return{recognizeAchievement:m,recognizeAchievement2:v,scannerOnLine:g,scannerOnLine2:p,scannerOnImage:t,initPromise:k,workerCV:e,workerOCR:s,onProgress:w}}let v;function m(){return v||(v=p()),v}},21277:function(e,n,s){function r(e,n){parent&&window!==parent&&parent.postMessage({app:"cocogoat.scanner.achievement",event:e,data:JSON.parse(JSON.stringify(n))},"*")}s.d(n,{l:function(){return r}})},83889:function(e,n,s){s.d(n,{Z:function(){return P}});var r=s(19812),a=s(55893);const i={class:"l"},t={class:"x"},o=(0,r._)("div",{class:"text"},[(0,r.Uk)("当前浏览器不支持此功能"),(0,r._)("br"),(0,r.Uk)("请升级或更换浏览器")],-1),l={key:1,class:"scanner-loading"},c={class:"loader-animation"},u=(0,r._)("div",{class:"loader-text"},"椰羊正在饮甘露，马上就来",-1),d={class:"loader-progress"},p={class:"loader-progress-text"};function v(e,n,s,v,m,g){const f=(0,r.up)("fa-icon"),w=(0,r.up)("icon-loading");return(0,r.wg)(),(0,r.iD)("div",null,[e.ocrCompatible?((0,r.wg)(),(0,r.iD)("div",l,[(0,r._)("div",{class:(0,a.C_)(e.$style.loader)},[(0,r._)("div",c,[(0,r.Wm)(w,{class:"loader-svg",percent:.88*e.progress+5},null,8,["percent"])]),u,(0,r._)("div",d,[(0,r._)("div",{class:"loader-progress-bar",style:(0,a.j5)({width:e.progress+"%"})},null,4)]),(0,r._)("div",p,[(0,r._)("span",null,(0,a.zw)(e.progressText||`${e.progress.toFixed(2)}%`),1)])],2)])):((0,r.wg)(),(0,r.iD)("div",{key:0,class:(0,a.C_)(e.$style.showUncompatible)},[(0,r._)("span",i,[(0,r.Wm)(f,{icon:["fab","internet-explorer"]}),(0,r._)("span",t,[(0,r.Wm)(f,{icon:"triangle-exclamation"})])]),o],2))])}var m=s(20521),g=s(40192),f=s(31060),w=s(21277),h=s(92002),k=s(1607),y=s(14287),_=s(75444);k.vI.add(y.ik8,_.EPy);var C=(0,r.aZ)({components:{IconLoading:h.Z},emits:["done"],setup(e,{emit:n}){const s=(0,m.iH)(0),a=(0,m.iH)("获取资源地址");return(0,r.bv)((async()=>{if(!g.KL)return;const e=(0,f.zG)();e.onProgress((e=>{if(!(s.value<0)){if((0,w.l)("load",e),s.value=e,e<-90)return(0,w.l)("load",!1),void(a.value="应用初始化失败, 请联系开发者");if(e<0)return(0,w.l)("load",!1),void(a.value="加载失败, 请刷新重试或联系开发者");a.value="",e>=100&&(a.value="校验完整性",setTimeout((()=>{(0,w.l)("load",!0),a.value="应用初始化"}),140))}})),e.initPromise.then((()=>{n("done")}))})),{ocrCompatible:g.KL,progress:s,progressText:a}}}),D={showUncompatible:"show-uncompatible-cfbfd0",loader:"loader-a3e60a",scannerCssloadLoader:"scanner-cssload-loader-eb1b08",scannerCssloadLoaderInner:"scanner-cssload-loader-inner-c70159"},L=s(48998);const b={};b["$style"]=D;const z=(0,L.Z)(C,[["render",v],["__cssModules",b]]);var P=z},89018:function(e,n,s){s.r(n),s.d(n,{default:function(){return A}});s(11723),s(26913);var r=s(93826),a=s(95980),i=s(19812),t=s(55893),o=s(44220);const l={key:0,class:"step1"},c=(0,i._)("span",null,[(0,i.Uk)("拖动第三方工具导出的图片集到这里"),(0,i._)("br"),(0,i.Uk)("或点击选择文件（支持多选）")],-1),u={class:"list"},d=["src"],p={key:1,class:"step2"},v={class:"inline-status"};function m(e,n,s,m,g,f){const w=(0,i.up)("Loader"),h=(0,i.up)("fa-icon"),k=a.GT,y=(0,i.up)("DynamicScrollerItem"),_=(0,i.up)("DynamicScroller"),C=r.Xh,D=(0,i.up)("float-content"),L=(0,i.Q2)("elloading");return(0,i.wg)(),(0,i.iD)("div",null,[e.load?((0,i.wg)(),(0,i.iD)("div",{key:1,class:(0,t.C_)(e.$style.listContainer)},[1===e.step?((0,i.wg)(),(0,i.iD)("div",l,[(0,i._)("div",{class:"top",style:(0,t.j5)(e.images.length>0?{}:{padding:0})},[(0,i._)("div",{class:(0,t.C_)(["dropzone",{"drag-over":e.dragOver}]),onDragover:n[2]||(n[2]=(0,o.iM)((n=>e.dragOver=!0),["prevent","stop"])),onDragleave:n[3]||(n[3]=n=>e.dragOver=!1),onDrop:n[4]||(n[4]=(0,o.iM)(((...n)=>e.onFileDrop&&e.onFileDrop(...n)),["prevent","stop"])),onClick:n[5]||(n[5]=(...n)=>e.dropzoneClick&&e.dropzoneClick(...n))},[(0,i._)("i",null,[(0,i.Wm)(h,{icon:"inbox"})]),c,(0,i._)("input",{ref:"fileInput",multiple:"",class:"file-input",type:"file",accept:"image/*",onChange:n[1]||(n[1]=(...n)=>e.onFileChange&&e.onFileChange(...n))},null,544)],34),e.images.length>0?((0,i.wg)(),(0,i.iD)("button",{key:0,onClick:n[6]||(n[6]=n=>e.step++)},"识别")):(0,i.kq)("",!0)],4),(0,i.wy)(((0,i.wg)(),(0,i.iD)("div",u,[(0,i.Wm)(_,{items:e.images,"min-item-size":52,"custom-scrollbar":e.CustomElScrollVue,class:"scroller","key-field":"id"},{before:(0,i.w5)((()=>[e.images.length<=0?((0,i.wg)(),(0,i.j4)(k,{key:0,description:"请添加图片"})):(0,i.kq)("",!0)])),default:(0,i.w5)((({item:e,active:n})=>[(0,i.Wm)(y,{item:e,active:n,"size-dependencies":[]},{default:(0,i.w5)((()=>[(0,i._)("img",{src:e.src},null,8,d)])),_:2},1032,["item","active"])])),_:1},8,["items","custom-scrollbar"])])),[[L,e.loading]])])):(0,i.kq)("",!0),2===e.step?((0,i.wg)(),(0,i.iD)("div",p,[(0,i.Wm)(C,{type:"circle",percentage:e.progress,format:e=>e.toFixed(2)+"%"},null,8,["percentage","format"]),(0,i._)("div",v,[(0,i.Wm)(D,{"in-float":!1,capture:!1,state:1,success:e.recognized.success,fail:e.recognized.fail,scanned:e.images.length,duplicate:e.dup},null,8,["success","fail","scanned","duplicate"])])])):(0,i.kq)("",!0)],2)):((0,i.wg)(),(0,i.j4)(w,{key:0,onDone:n[0]||(n[0]=n=>e.load=!0)}))])}var g=s(20521),f=s(83889),w=s(40192),h=s(31060),k=s(73823),y=s(97067),_=s(1607),C=s(14287),D=s(53389),L=(s(92542),s(86463)),b=s.n(L),z=s(13065),P=s(12507),O=s(77225),Z=s(21277);_.vI.add(C.wK3);var I=(0,i.aZ)({components:{Loader:f.Z,FloatContent:O.Z,DynamicScroller:y.cV,DynamicScrollerItem:y.Wk},directives:{elloading:D.t},setup(){const e=(0,g.iH)(!1),n=(0,g.iH)(!1),s=(0,g.iH)(1);if(!w.KL)return{load:e};const r=(0,g.iH)(null),a=(0,g.iH)([]),t=(0,g.iH)(!1),o=()=>{r.value&&r.value.click()},l=e=>{if(!e.dataTransfer)return;t.value=!1;const n=e.dataTransfer.files;u(n)},c=e=>{const n=e.target.files;n&&u(n)},u=async e=>{a.value=[],n.value=!0;const s=Array.from(e).map(((e,n)=>{const s=new FileReader;return s.readAsDataURL(e),new Promise((e=>{s.onload=()=>{const r=new Image;r.src=s.result,r.id="rcycle-img-"+n,r.onload=()=>{e(r)}}}))}));a.value=await Promise.all(s),n.value=!1},d=(0,g.iH)([]),p=(0,g.iH)(0),v=(0,i.Fl)((()=>({success:d.value.filter((e=>e.success)).length,fail:d.value.filter((e=>!e.success)).length}))),m=(0,i.Fl)((()=>(v.value.success+v.value.fail+p.value)/a.value.length*100));(0,i.YP)([a,v,p],(()=>{(0,Z.l)("progress",{scanned:a.value.length,...v.value,dup:p.value})}));const f=(0,z.yj)(),y=async({image:e,thread:n})=>{let s=D;n&&(s=L);const r=await(0,P.eW)(e),a=await s(r);if(a.success){const n=d.value.find((e=>{if(!e.success)return!1;const n=e;return n.achievement.id===a.achievement.id}));a.done&&!f.query.withImage||(a.images={main:e.src}),n?p.value++:d.value.push(a)}else a.images={main:e.src},d.value.push(a),(new Image).src=a.images.main},_=b().promise(y,2);async function C(){_.killAndDrain(),_.pause();let e=Promise.resolve();a.value.forEach(((n,s)=>{e=_.push({image:n,thread:s%2===0})})),_.resume(),await e,(0,Z.l)("state","finish"),(0,Z.l)("result",{result:d.value,dup:p.value})}(0,i.YP)(s,(e=>{2===e&&C()}));const{scannerOnLine:D,scannerOnLine2:L}=(0,h.zG)();return{step:s,load:e,loading:n,onFileDrop:l,onFileChange:c,dropzoneClick:o,fileInput:r,dragOver:t,CustomElScrollVue:k.Z,images:a,progress:m,recognized:v,results:d,dup:p}}}),F={listContainer:"list-container-a866fd"},x=s(48998);const W={};W["$style"]=F;const H=(0,x.Z)(I,[["render",m],["__cssModules",W]]);var A=H}}]);