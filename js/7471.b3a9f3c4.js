"use strict";(self["define"]=self["define"]||[]).push([[7471],{93525:function(e,a,l){l.r(a),l.d(a,{default:function(){return M}});l(11723),l(24611),l(26913);var n=l(93826),s=l(17336),i=l(95980),t=l(19812),r=l(55893),o=l(44220);const c={key:0,class:"step1"},u=(0,t._)("span",null,[(0,t.Uk)("点击选择圣遗物截图（支持多选）"),(0,t._)("br"),(0,t.Uk)("或拖动图片到这里")],-1),d={class:"list"},g=(0,t._)("p",null,[(0,t.Uk)(" 支持完整背包圣遗物页面截图和圣遗物面板截图 "),(0,t._)("br"),(0,t.Uk)(" 上传背包截图时请确保所有图片分辨率一致 "),(0,t._)("br"),(0,t.Uk)(" 如无法多选请更换浏览器 ")],-1),p={class:"image-content"},v=["src"],f={key:1,class:"step2"},m={class:"inline-status"};function h(e,a,l,h,k,w){const y=(0,t.up)("Loader"),D=(0,t.up)("fa-icon"),_=i.GT,C=s.Mr,F=n.Xh,H=(0,t.up)("float-content"),z=(0,t.Q2)("elloading");return(0,t.wg)(),(0,t.iD)("div",null,[e.load?((0,t.wg)(),(0,t.iD)("div",{key:1,class:(0,r.C_)(e.$style.listContainer)},[1===e.step?((0,t.wg)(),(0,t.iD)("div",c,[(0,t._)("div",{class:"top",style:(0,r.j5)(e.images.length>0?{}:{padding:0})},[(0,t._)("div",{class:(0,r.C_)(["dropzone",{"drag-over":e.dragOver}]),onDragover:a[2]||(a[2]=(0,o.iM)((a=>e.dragOver=!0),["prevent","stop"])),onDragleave:a[3]||(a[3]=a=>e.dragOver=!1),onDrop:a[4]||(a[4]=(0,o.iM)(((...a)=>e.onFileDrop&&e.onFileDrop(...a)),["prevent","stop"])),onClick:a[5]||(a[5]=(...a)=>e.dropzoneClick&&e.dropzoneClick(...a))},[(0,t._)("i",null,[(0,t.Wm)(D,{icon:"inbox"})]),u,(0,t._)("input",{ref:"fileInput",multiple:"",class:"file-input",type:"file",accept:"image/*",onChange:a[1]||(a[1]=(...a)=>e.onFileChange&&e.onFileChange(...a))},null,544)],34),e.images.length>0?((0,t.wg)(),(0,t.iD)("button",{key:0,onClick:a[6]||(a[6]=a=>e.step++)},"识别")):(0,t.kq)("",!0)],4),(0,t.wy)(((0,t.wg)(),(0,t.iD)("div",d,[(0,t.Wm)(C,null,{default:(0,t.w5)((()=>[e.images.length<=0?((0,t.wg)(),(0,t.j4)(_,{key:0},{description:(0,t.w5)((()=>[g])),_:1})):(0,t.kq)("",!0),(0,t._)("div",p,[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(e.images,(e=>((0,t.wg)(),(0,t.iD)("img",{key:e.id,src:e.src},null,8,v)))),128))])])),_:1})])),[[z,e.loading]])])):(0,t.kq)("",!0),2===e.step?((0,t.wg)(),(0,t.iD)("div",f,[(0,t.Wm)(F,{type:"circle",percentage:e.progress||0,format:e=>e.toFixed(2)+"%"},null,8,["percentage","format"]),(0,t._)("div",m,[(0,t.Wm)(H,{"in-float":!1,capture:!1,state:1,success:e.recognized.success,fail:e.recognized.fail,scanned:e.images.length,duplicate:e.dup},null,8,["success","fail","scanned","duplicate"])])])):(0,t.kq)("",!0)],2)):((0,t.wg)(),(0,t.j4)(y,{key:0,onDone:a[0]||(a[0]=a=>e.load=!0)}))])}var k=l(20521),w=l(56999),y=l(13137),D=l(1607),_=l(14287),C=l(53389),F=(l(92542),l(86463)),H=l.n(F),z=l(13065),U=l(12507),b=l(77225),I=l(45021),j=l(77194);D.vI.add(_.wK3);var q=(0,t.aZ)({components:{Loader:w.Z,FloatContent:b.Z},directives:{elloading:C.t},setup(){const e=(0,k.iH)(!1),a=(0,k.iH)(!1),l=(0,k.iH)(1),{onScreenShot:n,onScreenShot2:s}=(0,y.zG)(),i=(0,k.iH)(null),r=(0,k.iH)([]),o=(0,k.iH)(!1),c=()=>{i.value&&i.value.click()},u=e=>{if(!e.dataTransfer)return;o.value=!1;const a=e.dataTransfer.files;g(a)},d=e=>{const a=e.target.files;a&&g(a)},g=async e=>{r.value=[],a.value=!0;const l=Array.from(e).map(((e,a)=>new Promise((l=>{const n=new Image;n.src=URL.createObjectURL(e),n.id="rcycle-img-"+a,n.onload=()=>{l(n)}}))));r.value=await Promise.all(l),a.value=!1},p=(0,k.iH)([]),v=[],f=(0,k.iH)(0),m=(0,t.Fl)((()=>({success:p.value.filter((e=>e.success)).length,fail:p.value.filter((e=>!e.success)).length}))),h=(0,t.Fl)((()=>(m.value.success+m.value.fail+f.value)/r.value.length*100));(0,t.YP)([r,m,f],(()=>{(0,I.l)("progress",{scanned:r.value.length,...m.value,dup:f.value})}));const w=(0,z.yj)(),D=async({image:e,thread:a})=>{if(!e)return;const l=(0,U.eW)(e);let i=n;a&&(i=s);const t=await i(l);if(t.success&&t.artifact){const e=(0,j.n)(t.artifact);if(v.includes(e))return void f.value++;v.push(e)}let r="";t.success&&!w.query.withImage||(r=(0,U.rT)(t.image).toDataURL(),(new Image).src=r),p.value.push({...t,image:r})},_=H().promise(D,2);async function C(){_.killAndDrain(),_.pause();let e=Promise.resolve();(0,I.l)("state","processing"),r.value.forEach(((a,l)=>{e=_.push({image:a,thread:l%2===0})})),_.resume(),await e,(0,I.l)("state","finish"),(0,I.l)("result",{result:p.value,dup:f.value})}return(0,t.YP)(l,(e=>{2===e&&C()})),{step:l,load:e,loading:a,onFileDrop:u,onFileChange:d,dropzoneClick:c,fileInput:i,dragOver:o,images:r,progress:h,recognized:m,results:p,dup:f}}}),L={listContainer:"list-container-f2a475"},O=l(48998);const P={};P["$style"]=L;const W=(0,O.Z)(q,[["render",h],["__cssModules",P]]);var M=W}}]);