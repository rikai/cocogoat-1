"use strict";(self["define"]=self["define"]||[]).push([[8890],{10953:function(e,t,s){s.r(t),s.d(t,{default:function(){return fe}});var a=s(19812),i=s(55893);function l(e,t,s,l,n,c){const r=(0,a.up)("Loader"),o=(0,a.up)("c-ready"),d=(0,a.up)("c-progress"),u=(0,a.up)("float-content-b"),h=(0,a.up)("web-capturer");return(0,a.wg)(),(0,a.iD)("div",null,[!1===e.load?((0,a.wg)(),(0,a.j4)(r,{key:0,onDone:t[0]||(t[0]=t=>e.load=!0)})):((0,a.wg)(),(0,a.iD)("div",{key:1,class:(0,i.C_)(e.$style.scannerUi)},[3===e.step?((0,a.wg)(),(0,a.j4)(o,{key:0})):e.step>3?((0,a.wg)(),(0,a.j4)(d,{key:1})):(0,a.kq)("",!0),((0,a.wg)(),(0,a.j4)(h,{key:e.capKey,ref:"cap",popup:e.step>2&&e.step<5,onExit:t[1]||(t[1]=t=>e.step>3?e.step=5:e.reset()),onReady:t[2]||(t[2]=t=>e.step=3)},{default:(0,a.w5)((()=>[(0,a.Wm)(u,{state:4===e.step?1:0,success:e.resT.length,fail:e.resF.length,scanned:e.scanned,duplicate:e.duplicates,webControlEnabled:e.windowId>0?1:void 0},null,8,["state","success","fail","scanned","duplicate","webControlEnabled"])])),_:1},8,["popup"]))],2))])}var n=s(20521),c=(s(21703),s(42244)),r=s(93043),o=s(12507),d=s(13137),u=s(86463),h=s.n(u),w=s(77194);const p=document.createElement("canvas"),v=p.getContext("2d");let f=new AbortController;const g=(0,c.Q_)("artifact-capture-scanner",{state:()=>(f.abort(),f=new AbortController,{step:1,capKey:Date.now(),scanner:null,cap:null,panelRect:{x:0,y:0,width:0,height:0},centerRect:{x:0,y:0,width:0,height:0},countRect:{x:0,y:0,width:0,height:0},queue:null,results:[],resultHashes:[],scanned:0,duplicates:0}),getters:{resF:e=>e.results.filter((e=>!e.success)),resT:e=>e.results.filter((e=>e.success))},actions:{capture(){if(!this.cap)throw new Error("No video");return this.cap.capture({x:0,y:0,w:0,h:0})},capturePanel(){if(!this.cap)throw new Error("No video");return this.cap.capture({x:this.panelRect.x,y:this.panelRect.y,w:this.panelRect.width,h:this.panelRect.height})},async switchToNext(){if(!this.cap)throw new Error("No video");this.cap.windowId},async waitForSwitch(){if(!this.scanner)throw new Error("No scanner");const e=await(0,r.h)(this.scanner.diffCached.bind(this.scanner),this.capturePanel,{interval:50,threhold:8,signal:f.signal});return console.log("->changed",e.result),e.image},async analyzeUI(){if(!this.cap)throw new Error("No video");if(!this.scanner)throw new Error("No scanner");const e=this.capture(),t=await this.scanner.workerCV.analyzeBag(e);this.panelRect=t.panelRect,this.centerRect=t.centerRect,this.countRect=t.countRect,p.width=t.panelRect.width,p.height=t.panelRect.height,await Promise.all([this.scanner.workerCV.setCachedBag(t),this.scanner.workerOCR.setCachedBag(t)]),console.log("->analyzeUI",t)},async scannerLoop(){if(!this.cap)throw new Error("No video");if(!v)throw new Error("No canvas context");this.queue&&this.queue.killAndDrain(),this.queue=h().promise(y.worker,1),await this.analyzeUI();let e=this.capturePanel();while(4===this.step){this.scanned++,this.queue.push({image:e,id:this.scanned});try{e=await this.waitForSwitch()}catch(t){}}},async worker({image:e,id:t}){if(!this.scanner)throw new Error("No scanner");if(!this.queue)throw new Error("No queue");if(!e)return;let s=1,a=this.scanner.onScreenShot;2===this.queue.concurrency&&t%2===0&&(a=this.scanner.onScreenShot2,s=2);const i=await a(e),l={...i,image:(0,o.rT)(e).toDataURL()};if(l.success&&l.artifact){const e=(0,w.n)(l.artifact);this.resultHashes.includes(e)?(this.duplicates++,console.log(`->${s}dup`,l.artifact)):(console.log(`->${s}got`,l.artifact),this.results.push(l),this.resultHashes.push(e))}else this.results.push(l),console.warn(`->${s}fail`,l),(new Image).src=(0,o.rT)(e).toDataURL()}}}),y=g();(0,a.YP)((()=>y.step),(async e=>{return 1===e&&y.cap&&y.cap.reset(),4===e?(y.scanner=(0,d.zG)(),void y.scannerLoop()):5===e?(y.queue&&(y.queue.concurrency=2),console.log("->waiting for queue"),await(null===(t=y.queue)||void 0===t?void 0:t.push({image:null,id:-1})),console.log("->done"),void(y.step=6)):6===e&&y.cap?(f.abort(),f=new AbortController,void y.cap.stop()):void 0;var t}));var b=s(56999),x=(s(9917),s(62416),s(6504)),m=s(51064);const C={class:"content"},k=(0,a._)("div",{class:"title"},"还差最后一步",-1),R={class:"desc"},T=(0,a.Uk)(" 请手动切换到背包的圣遗物界面，然后点击下面按钮继续 "),E=(0,a._)("br",null,null,-1),I={key:0},_={key:1},S={key:2},V={class:"l"},D={class:"m"},q=(0,a._)("div",{class:"t"},"我已打开圣遗物背包",-1),z={key:0,class:"d"},N={key:1,class:"d"},F={class:"r"};function M(e,t,s,l,n,c){const r=m.v,o=(0,a.up)("fa-icon"),d=x.mi;return(0,a.wg)(),(0,a.iD)("div",{class:(0,i.C_)(e.$style.ready)},[(0,a._)("div",C,[k,(0,a._)("div",R,[T,E,e.hasPictureInPicture?((0,a.wg)(),(0,a.iD)("div",I,"如果没有看到悬浮窗，请点击页面空白处")):e.windowId>0?((0,a.wg)(),(0,a.iD)("div",_,[(0,a.Wm)(r,{title:"当前浏览器不支持悬浮窗",description:"如需中断扫描，请按Win键",type:"warning","show-icon":""})])):((0,a.wg)(),(0,a.iD)("div",S,[(0,a.Wm)(r,{title:"当前浏览器不支持悬浮窗",description:"完成翻页后，请点击“停止共享屏幕”按钮或手动回到本窗口点击停止扫描",type:"warning","show-icon":""})]))])]),(0,a.Wm)(d,{class:"start-btn start-gray",onClick:t[0]||(t[0]=t=>e.step++)},{default:(0,a.w5)((()=>[(0,a._)("div",V,[(0,a.Wm)(o,{icon:"toggle-on"})]),(0,a._)("div",D,[q,e.windowId>0?((0,a.wg)(),(0,a.iD)("div",z,"将自动切换到原神窗口并开始切换")):((0,a.wg)(),(0,a.iD)("div",N,"点击后请回到原神窗口并手动切换圣遗物"))]),(0,a._)("div",F,[(0,a.Wm)(o,{icon:"angle-right"})])])),_:1})],2)}var P=s(1607),W=s(14287),Z=s(40192);P.vI.add(W.WZW);var $=(0,a.aZ)({setup(){const e=g();return{hasPictureInPicture:Z.AM,step:(0,n.Vh)(e,"step"),windowId:(0,a.Fl)((()=>{var t;return(null===(t=e.cap)||void 0===t?void 0:t.windowId)||-1}))}}}),L={ready:"ready-df0c59"},A=s(48998);const H={};H["$style"]=L;const U=(0,A.Z)($,[["render",M],["__cssModules",H]]);var B=U;const K={class:"inline-status"},j={key:0,class:"no-box"},Y={key:1,class:"pbar"},G={key:0,class:"pbar-bar-text"};function O(e,t,s,l,n,c){const r=(0,a.up)("float-content");return(0,a.wg)(),(0,a.iD)("div",{class:(0,i.C_)(e.$style.statusInner),onClick:t[1]||(t[1]=t=>4===e.step&&(e.step=5))},[(0,a._)("div",K,[(0,a.Wm)(r,{"in-float":!1,capture:!1,state:1,success:e.resT.length,fail:e.resF.length,scanned:e.scanned,duplicate:e.duplicates},null,8,["success","fail","scanned","duplicate"])]),4===e.step?((0,a.wg)(),(0,a.iD)("div",j,(0,i.zw)(e.windowId>0?"自动切换进行中":"请手动切换圣遗物，并点这里停止"),1)):(0,a.kq)("",!0),e.step>4?((0,a.wg)(),(0,a.iD)("div",Y,[(0,a._)("div",{class:(0,i.C_)(["pbar-bar",{finish:6===e.step}])},[(0,a._)("div",{class:"pbar-bar-in",style:(0,i.j5)({width:(e.resT.length+e.resF.length+e.duplicates)/e.scanned*100+"%"})},null,4),6===e.step?((0,a.wg)(),(0,a.iD)("div",G,"完成")):(0,a.kq)("",!0)],2),6===e.step?((0,a.wg)(),(0,a.iD)("div",{key:0,class:"restart",onClick:t[0]||(t[0]=(...t)=>e.reset&&e.reset(...t))},"重新开始")):(0,a.kq)("",!0)])):(0,a.kq)("",!0)],2)}var Q=s(77225),J=(0,a.aZ)({components:{FloatContent:Q.Z},setup(){const e=g();return{step:(0,n.Vh)(e,"step"),resT:(0,n.Vh)(e,"resT"),resF:(0,n.Vh)(e,"resF"),scanned:(0,n.Vh)(e,"scanned"),duplicates:(0,n.Vh)(e,"duplicates"),capKey:(0,n.Vh)(e,"capKey"),windowId:(0,a.Fl)((()=>{var t;return(null===(t=e.cap)||void 0===t?void 0:t.windowId)||-1})),reset:()=>e.$reset()}}}),X={statusInner:"status-inner-cb54bb"};const ee={};ee["$style"]=X;const te=(0,A.Z)(J,[["render",O],["__cssModules",ee]]);var se=te;function ae(e,t,s,i,l,n){return(0,a.wg)(),(0,a.iD)("div")}const ie="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1024 1024' fill='%23fff'%3E%3Cpath d='M421.646 361.414v-93.081c0-7.562 2.678-13.996 8.038-19.366 5.354-5.346 11.812-8.022 19.366-8.022h246.373c7.562 0 14.012 2.676 19.356 8.022 5.37 5.372 8.038 11.804 8.038 19.366v246.405c0 7.554-2.668 13.988-8.038 19.358-5.346 5.328-11.794 8.024-19.356 8.024H602.35v202.605c0 10.576-3.736 19.582-11.254 27.102-7.484 7.462-16.514 11.232-27.1 11.232H219.07c-10.574 0-19.616-3.77-27.112-11.232-7.508-7.52-11.254-16.526-11.254-27.102V399.758c0-10.588 3.748-19.594 11.254-27.112 7.496-7.484 16.538-11.232 27.112-11.232h202.573zm0 60.234H279.31c-10.574 0-19.618 3.748-27.112 11.232-7.508 7.52-11.254 16.526-11.254 27.112v224.497c0 10.576 3.748 19.582 11.254 27.102 7.494 7.462 16.538 11.232 27.112 11.232h224.455c10.586 0 19.616-3.77 27.1-11.232 7.52-7.52 11.254-16.526 11.254-27.102V542.118h-93.066c-7.554 0-14.012-2.694-19.366-8.024-5.362-5.37-8.038-11.804-8.038-19.358v-93.088zm87.64-120.47c-7.554 0-14.012 2.678-19.366 8.024-5.362 5.37-8.038 11.804-8.038 19.368v125.936c0 7.554 2.678 13.988 8.038 19.358 5.354 5.33 11.812 8.024 19.366 8.024h125.906c7.562 0 14.012-2.694 19.356-8.024 5.37-5.37 8.037-11.804 8.037-19.358V328.57c0-7.562-2.667-13.996-8.037-19.368-5.346-5.346-11.794-8.024-19.356-8.024H509.288zM225.169 85.038l-49.932-28.83c-14.406-8.319-19.342-26.737-11.024-41.14s26.736-19.343 41.14-11.025l104.332 60.234c14.404 8.318 19.342 26.736 11.024 41.14L260.473 209.75c-8.318 14.406-26.736 19.342-41.14 11.024s-19.342-26.736-11.024-41.14l23.282-40.326c-40.44 15.522-74.804 37.426-103.092 65.712-42.704 42.704-71.337 99.733-85.903 171.087L.002 333.512c14.744-71.535 43.36-128.545 85.85-171.037 36.211-36.212 82.65-62.026 139.315-77.442zm536.998 808.386l49.932 28.828c14.404 8.318 19.342 26.736 11.024 41.14s-26.736 19.342-41.14 11.024L677.651 914.18c-14.404-8.318-19.341-26.736-11.024-41.14l60.236-104.331c8.318-14.404 26.736-19.342 41.14-11.024s19.342 26.736 11.024 41.14l-23.282 40.326c40.44-15.52 74.804-37.424 103.092-65.712 42.704-42.704 71.338-99.734 85.904-171.09l42.591 42.592c-14.744 71.534-43.36 128.548-85.85 171.038-36.211 36.212-82.649 62.025-139.315 77.441z'/%3E%3C/svg%3E",le="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1024 1024' fill='%23fff'%3E%3Cpath d='M468.867 212.468a43.133 43.133 0 1 0 86.266 0 43.133 43.133 0 1 0-86.266 0zM468.867 383.4a43.133 43.133 0 1 0 86.266 0 43.133 43.133 0 1 0-86.266 0zM468.867 554.334a43.133 43.133 0 1 0 86.266 0 43.133 43.133 0 1 0-86.266 0zM609.448 651.782L512 749.229l-97.448-97.447c-17.572-17.573-43.132-17.573-59.107 0s-17.573 43.132 0 59.107l127.8 127.8c7.987 7.988 20.767 12.78 30.353 12.78s20.767-4.792 30.352-12.78l127.8-127.8c17.573-17.572 17.573-43.132 0-59.107-19.17-17.573-44.73-17.573-62.302 0z'/%3E%3Cpath d='M555.133 0h-84.668C302.727 0 171.732 132.593 171.732 298.733v426.534c0 166.14 132.592 298.733 298.733 298.733h84.668c166.14 0 298.733-132.593 298.733-298.733V298.733C852.268 132.593 721.273 0 555.133 0zM767.6 723.67c0 119.812-94.253 212.467-212.468 212.467h-84.668c-119.813 0-212.468-94.252-212.468-212.468V298.733c0-119.813 94.253-212.468 212.468-212.468h84.668c119.812 0 212.468 94.253 212.468 212.468V723.67z'/%3E%3C/svg%3E",ne=new Image;ne.src=ie;const ce=new Image;ce.src=le;var re=(0,a.aZ)({props:{state:Number,success:Number,fail:Number,duplicate:Number,scanned:Number,webControlEnabled:Number},setup(e){const t=(0,a.f3)("canvas");function s(){const e=t.value.getContext("2d");e.textAlign="left",e.fillStyle="#fff",e.fillRect(0,0,t.value.width,t.value.height),e.fillStyle="#7e7e7e",e.fillRect(0,0,.28*t.value.width,t.value.height),e.drawImage(ne,.05*t.value.width,.112*t.value.width,.18*t.value.width,.18*t.value.width),e.fillStyle="#999",e.font=.056*t.value.width+"px 微软雅黑",e.fillText("请切换到游戏窗口",.42*t.value.width,.18*t.value.width),e.fillText("打开圣遗物背包页面",.4*t.value.width,.26*t.value.width)}function i(){const s=t.value.getContext("2d");s.textAlign="left",s.fillStyle="#fff",s.fillRect(0,0,t.value.width,t.value.height),s.fillStyle="#4096fe",s.fillRect(0,0,.28*t.value.width,t.value.height),s.drawImage(ce,.05*t.value.width,.112*t.value.width,.18*t.value.width,.18*t.value.width),s.font=.044*t.value.width+"px 微软雅黑",e.webControlEnabled&&e.webControlEnabled>0?(s.fillText("自动切换进行中，请勿移动鼠标",.348*t.value.width,.292*t.value.width),s.fillText("如需中断，请按Win键停止切换",.356*t.value.width,.352*t.value.width)):(s.fillText("手动切换圣遗物 完成后点此结束",.328*t.value.width,.292*t.value.width),s.fillText("尽量不要移动鼠标到圣遗物详情内",.316*t.value.width,.352*t.value.width)),s.fillText("扫描",.34*t.value.width,.092*t.value.width),s.fillStyle="#00b57a",s.fillText("成功",.508*t.value.width,.092*t.value.width),s.fillStyle="#cf0000",s.fillText("失败",.676*t.value.width,.092*t.value.width),s.fillStyle="#999",s.fillText("重复",.844*t.value.width,.092*t.value.width),l()}function l(){if(0===e.state)return;const s=t.value.getContext("2d");s.fillStyle="#fff",s.fillRect(.28*t.value.width,.112*t.value.width,.72*t.value.width,.12*t.value.width),s.font=.08*t.value.width+"px 微软雅黑",s.textAlign="center",s.fillStyle="#4096fe",s.fillText((e.scanned||0).toString(),.38*t.value.width,.2*t.value.width),s.fillStyle="#00b57a",s.fillText((e.success||0).toString(),.552*t.value.width,.2*t.value.width),s.fillStyle="#cf0000",s.fillText((e.fail||0).toString(),.72*t.value.width,.2*t.value.width),s.fillStyle="#999",s.fillText((e.duplicate||0).toString(),.888*t.value.width,.2*t.value.width)}return(0,a.YP)((()=>e.state),(e=>{0===e?s():i()})),(0,a.YP)(e,(()=>{l()}),{deep:!0}),(0,a.bv)((()=>{0===e.state?s():i()})),{}}});const oe=(0,A.Z)(re,[["render",ae]]);var de=oe,ue=s(91281),he=(0,a.aZ)({components:{Loader:b.Z,CReady:B,CProgress:se,FloatContentB:de,WebCapturer:ue.Z},setup(){const e=(0,n.iH)(!1),t=g();return t.$reset(),{load:e,step:(0,n.Vh)(t,"step"),resT:(0,n.Vh)(t,"resT"),resF:(0,n.Vh)(t,"resF"),scanned:(0,n.Vh)(t,"scanned"),duplicates:(0,n.Vh)(t,"duplicates"),capKey:(0,n.Vh)(t,"capKey"),cap:(0,n.Vh)(t,"cap"),windowId:(0,a.Fl)((()=>{var e;return(null===(e=t.cap)||void 0===e?void 0:e.windowId)||-1})),reset:()=>t.$reset()}}}),we={scannerUi:"scanner-ui-a7d844"};const pe={};pe["$style"]=we;const ve=(0,A.Z)(he,[["render",l],["__cssModules",pe]]);var fe=ve}}]);